---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by panghuhu.
--- DateTime: 2022/6/25 15:40
---

local redis = require "resty.redis"

local config = {
    host = "106.14.63.9",
    port = 6380,
    pass = "ly@981211"  -- redis 密码，没有密码的话，把这行注释掉
}

local _M = {}

local function close(self)
    local sock = self.sock
    if not sock then
        return nil, "not initialized"
    end
    if self.subscribed then
        return nil, "subscribed state"
    end
    return sock:setkeepalive(10000, 50)
end

function _M.new(self)
    local red = redis:new()
    red:set_timeout(1000) -- 1 second
    local res = red:connect(config['host'], config['port'])
    if not res then
        return nil
    end
    if config['pass'] ~= nil then
        res = red:auth(config['pass'])
        if not res then
            return nil
        end
    end
    red.close = close
    return red
end

return _M